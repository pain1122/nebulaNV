syntax = "proto3";

package blog;

message Post {
  string id             = 1;
  string slug           = 2;
  string title          = 3;
  string body           = 4;
  string excerpt        = 5;
  string coverImageUrl  = 6;


  string status         = 7;

  repeated string tags       = 8;
  repeated string categories = 9;

  string metaTitle       = 10;
  string metaDescription = 11;
  string metaKeywords    = 12;

  string publishedAt = 13;
  string createdAt   = 14;
  string updatedAt   = 15;
}

message PostInput {
  string title          = 1;
  string slug           = 2;
  string body           = 3;
  string excerpt        = 4;
  string coverImageUrl  = 5;
  string status         = 6;
  repeated string tags       = 7;
  repeated string categories = 8;
  string metaTitle       = 9;
  string metaDescription = 10;
  string metaKeywords    = 11;
}

message PostPatch {
  string title          = 1;
  string body           = 2;
  string excerpt        = 3;
  string coverImageUrl  = 4;
  string status         = 5;
  repeated string tags       = 6;
  repeated string categories = 7;
  string metaTitle       = 8;
  string metaDescription = 9;
  string metaKeywords    = 10;
}

message ListPostsRequest {
  string q         = 1;
  string tag       = 2;
  string category  = 3;
  int32  page      = 4;
  int32  limit     = 5;
}

message ListPostsResponse {
  repeated Post data = 1;
  int32 page         = 2;
  int32 limit        = 3;
  int64 total        = 4;
}

message GetPostRequest {
  string slug = 1;
}

message PostResponse {
  Post data = 1;
}

message CreatePostRequest {
  PostInput data = 1;
}

message UpdatePostRequest {
  string   id    = 1;
  PostPatch patch = 2;
}

message DeletePostRequest {
  string id = 1;
}

message BasicResponse {
  bool   success = 1;
  string message = 2;
}


service BlogService {
  rpc ListPosts (ListPostsRequest) returns (ListPostsResponse);
  rpc GetPost   (GetPostRequest)   returns (PostResponse);

  rpc CreatePost (CreatePostRequest)  returns (PostResponse);
  rpc UpdatePost (UpdatePostRequest)  returns (PostResponse);
  rpc DeletePost (DeletePostRequest)  returns (BasicResponse);
}


// -----------------------------------------
// Blog taxonomy – backed by taxonomy-service
// scope will be hard-locked to "blog" in blog-service
// -----------------------------------------
message BlogTaxonomy {
  string id          = 1;
  string scope       = 2;
  string kind        = 3;
  string slug        = 4;
  string title       = 5;
  string description = 6;
  string parentId    = 7;
  string path        = 8;
  bool   isHidden    = 9;
  bool   isSystem    = 10;
  int32  sortOrder   = 11;
  bool   hasChildren = 12;

  string createdAt   = 13;
  string updatedAt   = 14;
}

message BlogTaxonomyResponse {
  BlogTaxonomy data = 1;
}

message ListBlogTaxonomiesRequest {
  string kind     = 1; // e.g. "category.default", "tag.default"
  int32  page     = 2;
  int32  limit    = 3;
  string q        = 4;
  string parentId = 5; // optional: filter by parent
}

message ListBlogTaxonomiesResponse {
  repeated BlogTaxonomy data = 1;
  int32 page                  = 2;
  int32 limit                 = 3;
  int32 total                 = 4;
}

message GetBlogTaxonomyRequest {
  string id = 1;
}

message CreateBlogTaxonomyRequest {
  string kind        = 1;
  string slug        = 2;
  string title       = 3;
  string description = 4;
  string parentId    = 5; // optional
  bool   isHidden    = 6;
  int32  sortOrder   = 7;
}

message UpdateBlogTaxonomyRequest {
  string id          = 1;
  string slug        = 2;
  string title       = 3;
  string description = 4;
  string parentId    = 5;
  bool   isHidden    = 6;
  int32  sortOrder   = 7;
}

message DeleteBlogTaxonomyRequest {
  string id = 1;
}

message DeleteBlogTaxonomyResponse {
  bool success = 1;
}

// -----------------------------------------
// BlogTaxonomyService – exposed by blog-service
// but backed by taxonomy-service
// -----------------------------------------
service BlogTaxonomyService {
  rpc List   (ListBlogTaxonomiesRequest)   returns (ListBlogTaxonomiesResponse);
  rpc Get    (GetBlogTaxonomyRequest)      returns (BlogTaxonomyResponse);
  rpc Create (CreateBlogTaxonomyRequest)   returns (BlogTaxonomyResponse);
  rpc Update (UpdateBlogTaxonomyRequest)   returns (BlogTaxonomyResponse);
  rpc Delete (DeleteBlogTaxonomyRequest)   returns (DeleteBlogTaxonomyResponse);
}
