generator client {
  provider      = "prisma-client-js"
  output        = "./generated"
  binaryTargets = ["native", "linux-musl"]
}

datasource db {
  provider          = "postgresql"
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

enum MediaStatus {
  PENDING
  READY
  BLOCKED
  DELETED
}

enum ScanStatus {
  NONE
  QUEUED
  SCANNING
  CLEAN
  INFECTED
  FAILED
}

model Media {
  id          String   @id @default(uuid()) @db.Uuid

  storage     String   @default("local")
  bucket      String?
  path        String
  filename    String
  mimeType    String
  sizeBytes   Int

  width       Int?
  height      Int?
  durationSec Int?

  ownerId     String?  @db.Uuid
  visibility  String   @default("private")
  scope       String   @default("panel")

  sha256      String?  @unique

  // ✅ lifecycle + malware pipeline
  status      MediaStatus @default(PENDING)
  scanStatus  ScanStatus  @default(NONE)
  scannedAt   DateTime?
  scanError   String?

  // ✅ requested fields
  quarantineReason String?   // why blocked/quarantined
  etag             String?   // storage metadata to lock integrity
  promotedAt       DateTime? // when moved from pending -> ready path

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([ownerId])
  @@index([visibility])
  @@index([scope])
  @@index([status])
  @@index([scanStatus])
  @@index([promotedAt])
}
